if (project.isBuildSrcProject) return

allprojects {
    pluginManager.withPlugin('maven-publish') {
        rootProject.apply plugin: 'io.github.gradle-nexus.publish-plugin'
    }

    pluginManager.withPlugin('io.github.gradle-nexus.publish-plugin') {
        nexusPublishing {
            repositories {
                sonatype()
            }
        }
    }
}


File flagFile = project.file("${rootProject.buildDir}/publish-maven-central.flag")
flagFile.delete()
allprojects {
    pluginManager.withPlugin('io.github.gradle-nexus.publish-plugin') {
        flagFile.parentFile.mkdirs()
        flagFile.text = ''
    }
}
