tasks.named('generateResources') {
    inputs.files([Checkstyle].collect { it.protectionDomain?.codeSource?.location }.findAll { it != null }.toSet()).optional()

    binaryFile("${project.calculateBaseJavaPackage().replace('.', '/')}/issues/checkstyle.xsl") { OutputStream outputStream ->
        String resourceName = 'checkstyle-noframes-sorted.xsl'
        InputStream inputStream = Checkstyle.getClassLoader().getResourceAsStream(resourceName)
        if (inputStream == null) {
            throw new IllegalStateException("Resource can't be found: " + resourceName)
        }
        String content = inputStream.getText('UTF-8')

        //content = content.replaceFirst(/(?i)<table[^>]*>[\s\S]*?<h2[^>]*>\s*CheckStyle Audit\s*<\/h2>[\s\S]*?<\/table>\s*<hr[^>]*>\s*/, '')
        content = content.replaceFirst(/(?i)<!--\s*jakarta logo\s*-->[\s\S]*?(<!--\s*Summary part\s*-->)/, '$1')

        content = content.replaceAll(/(<xsl:number\s+)level="[^"]*"\s+(value=[^>]+>)/, '$1$2')

        outputStream.bytes = content.getBytes('UTF-8')
    }
}
